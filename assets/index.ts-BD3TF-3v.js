import{d as S,b as f}from"./utils-Da4cKvUs.js";const I=(n={})=>{const{partnerName:t=null,partnerLogo:r=null,message:p="Confirm this action in the extension!",backgroundColor:i="#18181b",fontColor:l="#ffffff",displayTime:c=null}=n,e=document.createElement("div");e.id="steamauth-notification",e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive");const o=document.createElement("div");if(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.gap="8px",o.style.textAlign="center",r){const v=document.createElement("div");v.style.display="flex",v.style.justifyContent="center";const y=document.createElement("img");y.src=r,y.alt=t?`${t} Logo`:"Partner Logo",y.style.height="60px",y.style.width="60px",y.style.objectFit="contain",y.style.borderRadius="50%",v.appendChild(y),o.appendChild(v)}const d=document.createElement("div");d.style.fontWeight="600",d.style.fontSize="15px",d.textContent=t?`SteamAuth x ${t}`:"SteamAuth",o.appendChild(d);const s=document.createElement("div");s.style.fontSize="15px",s.style.opacity="0.9",s.textContent=p,o.appendChild(s),e.appendChild(o);const m=S(i);e.style.position="fixed",e.style.top="0px",e.style.right="0px",e.style.background=`linear-gradient(to bottom, ${i}, ${m})`,e.style.color=l,e.style.padding="16px",e.style.zIndex="100000",e.style.borderRadius="12px",e.style.fontFamily="'IBM Plex Sans', 'Arial', sans-serif",e.style.fontSize="13px",e.style.boxShadow="rgba(0, 0, 0, 0.3) 0px 8px 16px",e.style.margin="16px",e.style.border="1px solid rgba(255, 255, 255, 0.1)",e.style.backdropFilter="blur(10px)",e.style.maxWidth="280px",e.style.transition="opacity 0.3s ease-in-out",document.body.appendChild(e);const h=3e3,a=20,u=(t?.length||0)+(p?.length||30),E=c??Math.min(Math.max(h,u*a),6e3);return setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),300)},E),e},C={readyEvent:"steamAuthReady",readyAttr:"data-steamauth-ready",ackAttr:"data-steamauth-ack",retryAttr:"data-steamauth-retry",installationIdKey:"installationId",initialDelayMs:1e3,intervalMs:500,maxMs:15e3},L=async(n={})=>{try{const t={...C,...n},r=await f.storage.local.get([t.installationIdKey,"steamId"]),p=r[t.installationIdKey]??null,i=r.steamId??null;let l=null;const c=()=>{l&&(clearInterval(l),l=null)},e=()=>document.documentElement?.getAttribute(t.ackAttr)==="1",o=a=>{if(e()){c();return}document.documentElement?.setAttribute(t.readyAttr,"1"),document.dispatchEvent(new CustomEvent(t.readyEvent,{detail:{source:"steamauth-extension",installationId:p,steamId:i,attempt:a,timestamp:Date.now()}}))};let d=0;const s=()=>{c(),d=Date.now();let a=0;o(a),l=setInterval(()=>{if(a+=1,Date.now()-d>t.maxMs){c();return}o(a)},t.intervalMs)};let m=null;return(()=>{m||(m=new MutationObserver(a=>{for(const u of a)u.attributeName===t.ackAttr&&e()&&c(),u.attributeName===t.retryAttr&&document.documentElement?.getAttribute(t.retryAttr)&&(document.documentElement?.removeAttribute(t.ackAttr),document.documentElement?.removeAttribute(t.retryAttr),s())}),m.observe(document.documentElement,{attributes:!0,attributeFilter:[t.ackAttr,t.retryAttr]}))})(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(s,t.initialDelayMs)}):setTimeout(s,t.initialDelayMs),window.addEventListener("pageshow",s),()=>{c(),m?.disconnect(),m=null,window.removeEventListener("pageshow",s)}}catch(t){console.error("Error initializing Steam Auth Ready Bridge:",t)}},x={CLIENT:"steamauth"};async function k(){const n="__STEAMAUTH_IGNORE_SCAM__";if(typeof window.name=="string"&&window.name.includes(n)){window.name=window.name.replace(n,""),sessionStorage.setItem("steamauth_ignore_scam_warning","true");return}if(sessionStorage.getItem("steamauth_ignore_scam_warning")!=="true")try{const r=(await f.storage.local.get("setting-store"))["setting-store"];if(r){let a;if(typeof r=="string"?a=JSON.parse(r):a=r,(a?.state??a??{}).steamAuthEnabled===!1)return}const i=(await f.storage.local.get("scam-sites-store"))["scam-sites-store"];if(!i)return;let l;typeof i=="string"?l=JSON.parse(i):l=i;const c=l?.state??l??{},e=c.isEnabled!==!1,o=c.sites||[];if(!e)return;const d=window.location.hostname.toLowerCase().trim(),s=a=>a.toLowerCase().trim().replace(/^www\./,""),m=s(d),h=o.find(a=>{if(!a.blocked)return!1;const u=s(a.host);return m===u||m.endsWith(`.${u}`)});h&&T(d,h.reason)}catch(t){console.error("[SteamAuth] Error checking scam site:",t)}}function T(n,t){window.stop();const r=new URL(f.runtime.getURL("blocked.html"));r.searchParams.set("site",n),t&&r.searchParams.set("reason",t),r.searchParams.set("url",window.location.href),window.location.replace(r.toString())}k();const M=n=>n?String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;"):"",N=n=>{if(!n)return!1;try{const t=new URL(String(n));return["http:","https:"].includes(t.protocol)&&String(n).match(/\.(jpeg|jpg|gif|png|svg|webp)$/i)!==null}catch{return!1}};L();const D=25e3;let g=null,w=null;function b(){try{if(g)try{g.disconnect()}catch{}g=f.runtime.connect({name:"keep-alive"}),g.onDisconnect.addListener(()=>{g=null,setTimeout(b,1e3)}),w&&clearInterval(w),w=setInterval(()=>{if(g)try{g.postMessage({type:"ping"})}catch{b()}},D)}catch{setTimeout(b,5e3)}}b();document.addEventListener("visibilitychange",()=>{!document.hidden&&!g&&b()});const A=()=>{try{f.runtime.sendMessage({event:"tabPresence",hostname:window.location.hostname}).catch(()=>{})}catch{}};f.runtime.onMessage.addListener(n=>{const{detail:t,listener:r,event:p}=n||{};if(p==="checkTabPresence"){A();return}if(n?.type==="play-sound"&&n?.soundUrl){try{const i=new Audio(n.soundUrl);i.volume=.5,i.play().catch(()=>{})}catch{}return}r===x.CLIENT&&(t?.type==="error"&&I({partnerName:M(t.config?.partnerName)||null,partnerLogo:N(t.config?.partnerLogo)?t.config.partnerLogo:null,backgroundColor:t.config?.backgroundColor||"#18181b",message:"Confirm this action in the extension!"}),document.dispatchEvent(new CustomEvent(x.CLIENT,{detail:t})))});A();document.addEventListener("visibilitychange",()=>{document.hidden||A()});
