import{b as e,L as w}from"./browser-polyfill-DaZBtFLh.js";import{W as x,u as h,a as g,p}from"./worker-D3Z6_Ofr.js";const E=()=>{let c=e.action??e.browserAction;e.runtime.onMessage.addListener((a,d,r)=>{if(a.event==="popupOpened")return x.init(),c.setBadgeText({text:""}),!0;if(a.event==="closeExtension"){console.log("Received closeExtension message"),r({received:!0});try{if(typeof chrome<"u"&&chrome.runtime){const l=chrome.runtime.id;chrome.management&&chrome.management.setEnabled?chrome.management.setEnabled(l,!1,()=>{if(chrome.runtime.lastError)console.log("Could not disable extension:",chrome.runtime.lastError),e.runtime.reload();else{r({success:!0});return}}):e.runtime.reload(),e.windows.getCurrent().then(n=>{e.windows.remove(n.id),e.windows.getAll({populate:!0}).then(t=>{let s=!1;const o=t.map(i=>i.tabs&&i.tabs.some(m=>m.url&&(chrome.runtime&&m.url.startsWith(`chrome-extension://${chrome.runtime.id}/`)||m.url.includes("steamauth")))?(s=!0,e.windows.remove(i.id)):Promise.resolve());Promise.all(o).then(()=>{r({success:!0,closedWindows:s})}).catch(i=>{console.error("Error closing windows:",i),r({success:!1,error:i.message})})}).catch(t=>{console.error("Failed to get all windows:",t),r({success:!1,error:t.message})})}).catch(n=>{console.error("Failed to get current window:",n),e.windows.getAll({populate:!0}).then(t=>{const s=t.map(o=>o.tabs&&o.tabs.some(u=>u.url&&(chrome.runtime&&u.url.startsWith(`chrome-extension://${chrome.runtime.id}/`)||u.url.includes("steamauth")))?e.windows.remove(o.id):Promise.resolve());Promise.all(s).then(()=>r({success:!0})).catch(o=>r({success:!1,error:o.message}))}).catch(t=>{r({success:!1,error:t.message})})})}else e.windows.getCurrent().then(l=>{e.windows.remove(l.id),e.windows.getAll({populate:!0}).then(n=>{let t=!1;const s=n.map(o=>o.tabs&&o.tabs.some(u=>u.url&&u.url.includes("steamauth"))?(t=!0,e.windows.remove(o.id)):Promise.resolve());Promise.all(s).then(()=>{r({success:!0,closedWindows:t})}).catch(o=>{console.error("Error closing windows:",o),r({success:!1,error:o.message})})}).catch(n=>{console.error("Failed to get all windows:",n),r({success:!0})})}).catch(l=>{console.error("Failed to get current window:",l),e.windows.getAll({populate:!0}).then(n=>{const t=n.map(s=>s.tabs&&s.tabs.some(i=>i.url&&i.url.includes("steamauth"))?e.windows.remove(s.id):Promise.resolve());Promise.all(t).then(()=>r({success:!0})).catch(s=>r({success:!1,error:s.message}))}).catch(n=>{r({success:!1,error:n.message})})})}catch(l){console.error("Failed to close extension:",l),console.error("Error details:",JSON.stringify(l)),r({success:!1,error:l.message})}return!0}}),h.subscribe(a=>{a.open&&(c.setBadgeText({text:"1"}),c.setBadgeBackgroundColor({color:"#ef4444"}),c.setBadgeTextColor({color:"#fff"}))});const f=async({eventDetails:a,listener:d})=>{if(d===w.RUNTIME){a.config?g.getState().updateTheme(a.config):g.getState().resetTheme(),h.setState({open:!0,state:"pending",eventDetails:a});try{e.action?await e.action.openPopup():e.browserAction&&await e.browserAction.openPopup()}catch(r){console.log("Info: Could not automatically open popup. User can click the extension icon to view the notification.",r.message),c&&(c.setBadgeText({text:"1"}),c.setBadgeBackgroundColor({color:"#ef4444"}),c.setBadgeTextColor({color:"#fff"}))}}};e.runtime.onMessage.addListener(f)};e.runtime.onInstalled.addListener(async()=>{try{await p()}catch(c){console.log("Error on extension install",c)}});E();
